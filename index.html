<!DOCTYPE html>
<html>
<head>
    <title>Map of KFC and Taco Bell Locations</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f5f5f7;
            color: #1d1d1f;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        h1 {
            font-weight: 600;
            margin: 20px 0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        label {
            font-size: 16px;
            font-weight: 500;
        }
        select {
            font-size: 16px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        select:hover {
            border-color: #007aff;
        }
        #map {
            height: 700px;
            width: 100%;
            margin-top: 20px;
            border-radius: 12px;
        }
    </style>
    <!-- Load PapaParse library from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        let map;
        let markers = [];
        // Global variable to hold CSV data
        let allLocations = [];

        // Function to load the Google Maps API script dynamically
        function loadScript() {
            const apiKey = 'AIzaSyDM5PYHiEkRV4tCdBpP7tKrRtobVXoCzSo';
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap`;
            script.async = true;
            script.defer = true;
            script.onerror = function() {
                console.error('Google Maps script failed to load. Check API key and network connection.');
                alert('Failed to load Google Maps. Please check the API key or internet connection.');
            };
            document.head.appendChild(script);
        }

        // Initialize the map and load CSV data
        function initMap() {
            if (typeof google === 'undefined' || !google.maps) {
                console.error('Google Maps API failed to load.');
                alert('Google Maps failed to load. Please check API key permissions.');
                return;
            }

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 7,
                center: { lat: -27.5, lng: 153.0 },
                styles: [
                    { elementType: 'geometry', stylers: [{ color: '#f5f5f7' }] },
                    { elementType: 'labels.text.fill', stylers: [{ color: '#1d1d1f' }] },
                    { elementType: 'labels.text.stroke', stylers: [{ color: '#ffffff' }] }
                ]
            });

            // Load CSV data using PapaParse
            Papa.parse('Untitled Spreadsheet.csv', {
                download: true,
                header: true,
                complete: function(results) {
                    console.log("CSV data loaded", results.data);
                    // Save the parsed data to the global variable
                    allLocations = results.data;
                    // Add all markers initially
                    addMarkers('All');
                },
                error: function(err) {
                    console.error("Error loading CSV file", err);
                    alert("Error loading CSV file");
                }
            });
        }

        // Add markers to the map based on the selected filter
        function addMarkers(filter) {
            clearMarkers();
            allLocations.forEach(function(location) {
                // If the filter is 'All' or matches the location type
                if (filter === 'All' || location.type === filter) {
                    let marker = new google.maps.Marker({
                        position: { lat: parseFloat(location.lat), lng: parseFloat(location.lng) },
                        map: map,
                        title: location.name,
                        icon: "https://maps.google.com/mapfiles/kml/shapes/cycling.png"
                    });
                    
                    let infoWindow = new google.maps.InfoWindow({
                        content: `<strong>${location.name}</strong><br>${location.address}`
                    });
                    
                    marker.addListener("click", function() {
                        infoWindow.open(map, marker);
                    });
                    
                    markers.push(marker);
                }
            });
        }

        // Remove existing markers from the map
        function clearMarkers() {
            markers.forEach(marker => marker.setMap(null));
            markers = [];
        }
    </script>
</head>
<body onload="loadScript()">
    <div class="container">
        <h1>Map of KFC and Taco Bell Locations</h1>
        <label for="filter">Filter by:</label>
        <select id="filter" onchange="addMarkers(this.value)">
            <option value="All">All</option>
            <option value="KFC">KFC</option>
            <option value="Taco Bell">Taco Bell</option>
        </select>
        <div id="map"></div>
    </div>
</body>
</html>
